<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.552">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Statistical Programming - 6&nbsp; Summarization</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./visualization.html" rel="next">
<link href="./featproc.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./summarization.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Summarization</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Statistical Programming</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./getting_started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Getting Started</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reading_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Reading Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wrangling_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Wrangling Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./featproc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Feature and Target Processing</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summarization.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Summarization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Visualization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./matrices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Vectors and Matrices</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./random.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Random Numbers</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./debugging.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Debugging in <code>R</code></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./parallel.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Parallel Computing in <code>R</code></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./reproducibility.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Reproducible Research and Data Analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./irls_literate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Iteratively Reweighted Least Squares</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./latex_basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title"><span class="math inline">\(\LaTeX\)</span> Basics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./sql_basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">SQL Basics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">6.1</span> Introduction</a></li>
  <li><a href="#location-and-dispersion-statistics" id="toc-location-and-dispersion-statistics" class="nav-link" data-scroll-target="#location-and-dispersion-statistics"><span class="header-section-number">6.2</span> Location and Dispersion Statistics</a>
  <ul>
  <li><a href="#stats-package" id="toc-stats-package" class="nav-link" data-scroll-target="#stats-package"><code>stats</code> Package</a></li>
  <li><a href="#dplyr-package" id="toc-dplyr-package" class="nav-link" data-scroll-target="#dplyr-package"><code>dplyr</code> Package</a></li>
  </ul></li>
  <li><a href="#group-by-summarization" id="toc-group-by-summarization" class="nav-link" data-scroll-target="#group-by-summarization"><span class="header-section-number">6.3</span> Group-by Summarization</a>
  <ul>
  <li><a href="#using-statsaggregate" id="toc-using-statsaggregate" class="nav-link" data-scroll-target="#using-statsaggregate">Using <code>stats::aggregate</code></a></li>
  <li><a href="#using-dplyrgroup_by" id="toc-using-dplyrgroup_by" class="nav-link" data-scroll-target="#using-dplyrgroup_by">Using <code>dplyr::group_by</code></a></li>
  <li><a href="#continuous-grouping-variable" id="toc-continuous-grouping-variable" class="nav-link" data-scroll-target="#continuous-grouping-variable">Continuous Grouping Variable</a></li>
  </ul></li>
  <li><a href="#in-database-analytics" id="toc-in-database-analytics" class="nav-link" data-scroll-target="#in-database-analytics"><span class="header-section-number">6.4</span> In-database Analytics</a>
  <ul>
  <li><a href="#advantages" id="toc-advantages" class="nav-link" data-scroll-target="#advantages">Advantages</a></li>
  <li><a href="#disadvantages" id="toc-disadvantages" class="nav-link" data-scroll-target="#disadvantages">Disadvantages</a></li>
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example">Example</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-summarization" class="quarto-section-identifier"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Summarization</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">6.1</span> Introduction</h2>
<div class="definition">
<div class="definition-header">
<p>Definition: Data Summarization</p>
</div>
<div class="definition-container">
<p>Data <strong>summarization</strong> is the numerical, tabular, and graphical distillation of the essence of a data set and the relationships between its variables through aggregation.</p>
</div>
</div>
<p>A single statistic such as the sample standard deviation is a summary, as is a cross-tabulation of the levels of two categorical variables, as is a series of box plots. The purposes of data summarization are many:</p>
<ul>
<li><p><strong>Profiling</strong>. <span class="citation" data-cites="Borne_2021_profiling">Borne (<a href="references.html#ref-Borne_2021_profiling" role="doc-biblioref">2021</a>)</span> refers to it as “having that first date with your data.” We want to know what we are dealing with.</p></li>
<li><p><strong>Description</strong>. What are the central tendencies and the dispersion of the variables? For example, what does the comparison of statistics measuring the central tendency tell us about the distribution of the data, the presence of outliers? What distributional assumptions are reasonable for the data. Are transformations in a feature processing step called for?</p></li>
<li><p><strong>Aggregation</strong>. Suppose you could not store the raw data but you need to retain information for future statistical processing. What kind of information would you compute and squirrel away? A <strong>sufficient</strong> statistic is a function of the data that contains all information toward estimating a parameter of the data distribution. For example, the sample mean <span class="math inline">\(\frac{1}{n}\sum_{i=1}^n Y_i\)</span> is sufficient to estimate the mean of a set of <span class="math inline">\(n\)</span> independent and identically distributed random variables. If <span class="math inline">\(Y\)</span> is uniform on <span class="math inline">\([0,\theta]\)</span>, then <span class="math inline">\(\max\{Y_i\}\)</span> is sufficient for <span class="math inline">\(\theta\)</span>. The quantities we compute during summarization are frequently sufficient statistics; examples are sums, sums of squares, sums of crossproducts.</p></li>
<li><p><strong>Relationships</strong>. Summarization is not only about individual variables, but also about their relationship. The correlation matrix of <span class="math inline">\(p\)</span> numerical variables is a frequent summary that describes the pairwise linear relationships in the data.</p></li>
<li><p><strong>Dimension Reduction</strong>. In high-dimensional statistical problems the number of potential input variables is larger than what we can handle (on computational grounds) or should handle (on statistical grounds). Summarization can reduce a <span class="math inline">\(p\)</span>-dimensional problem to an <span class="math inline">\(m\)</span>-dimensional problem where <span class="math inline">\(m \ll p\)</span>. Principal component analysis (PCA) relies on matrix factorization (eigenvalue or singular value decomposition) of a crossproduct matrix to find a set of <span class="math inline">\(m\)</span> linear combinations of the <span class="math inline">\(p\)</span> input variables that explain a substantial amount of variability in the data. The <span class="math inline">\(m\)</span> linear combinations summarize the essence of the relationships in the data.</p></li>
</ul>
</section>
<section id="location-and-dispersion-statistics" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="location-and-dispersion-statistics"><span class="header-section-number">6.2</span> Location and Dispersion Statistics</h2>
<p>Common location and dispersion measures for quantitative variables are shown in <a href="#tbl-loc-stats" class="quarto-xref">Table&nbsp;<span>6.1</span></a> and <a href="#tbl-disp-stats" class="quarto-xref">Table&nbsp;<span>6.2</span></a>.</p>
<div id="tbl-loc-stats" class="striped quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-loc-stats-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;6.1: Important statistics measuring location attributes of a variable in a sample of size <span class="math inline">\(n\)</span>. Sample mean, sample median, and sample mode are measures of the central tendency of a variable. <span class="math inline">\(Y^*\)</span> denotes the ordered sequence of observations and <span class="math inline">\(Y^*[k]\)</span> the value at the <span class="math inline">\(k\)</span>th position in the ordered sequence. The min is defined as the smallest non-missing value because NaNs often sort as the smallest values in software packages.
</figcaption>
<div aria-describedby="tbl-loc-stats-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-striped table">
<colgroup>
<col style="width: 20%">
<col style="width: 16%">
<col style="width: 20%">
<col style="width: 42%">
</colgroup>
<thead>
<tr class="header">
<th>Sample Statistic</th>
<th>Symbol</th>
<th style="text-align: center;">Computation</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Min</td>
<td></td>
<td style="text-align: center;"><span class="math inline">\(Y^*[1]\)</span></td>
<td>The smallest non-missing value</td>
</tr>
<tr class="even">
<td>Max</td>
<td></td>
<td style="text-align: center;"><span class="math inline">\(Y^*[n]\)</span></td>
<td>The largest value</td>
</tr>
<tr class="odd">
<td>Mean</td>
<td><span class="math inline">\(\overline{Y}\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\frac{1}{n}\sum_{i=1}^n Y_i\)</span></td>
<td>Most important location measure, but can be affected by outliers</td>
</tr>
<tr class="even">
<td>Median</td>
<td>Med</td>
<td style="text-align: center;"><span class="math display">\[\left \{    \begin{array}{cc}       Y^* \left[ \frac{n+1}{2} \right ] &amp; n \text{ is even} \\        \frac{1}{2} \left( Y^* \left[\frac{n}{2} \right] + Y^* \left[\frac{n}{2}+1\right] \right) &amp; n\text{ is odd} \end{array}\right .\]</span></td>
<td>Half of the observations are smaller than the median; robust against outliers</td>
</tr>
<tr class="odd">
<td>Mode</td>
<td>Mode</td>
<td style="text-align: center;"></td>
<td>The most frequent value; not useful when real numbers are unique</td>
</tr>
<tr class="even">
<td>1st Quartile</td>
<td></td>
<td style="text-align: center;"><span class="math inline">\(Y^*\left[\frac{1}{4}(n+1) \right]\)</span></td>
<td>25% of the observations are smaller than <span class="math inline">\(Q_1\)</span></td>
</tr>
<tr class="odd">
<td>2nd Quartile</td>
<td></td>
<td style="text-align: center;">See Median</td>
<td>50% of the observations are smaller than <span class="math inline">\(Q_2\)</span>. This is the median</td>
</tr>
<tr class="even">
<td>3rd Quartile</td>
<td></td>
<td style="text-align: center;"><span class="math inline">\(Y^*\left[\frac{3}{4}(n+1) \right]\)</span></td>
<td>75% of the observations are smaller than <span class="math inline">\(Q_3\)</span></td>
</tr>
<tr class="odd">
<td>X% Percentile</td>
<td></td>
<td style="text-align: center;"><span class="math inline">\(Y^*\left[\frac{X}{100}(n+1) \right]\)</span></td>
<td>For example, 5% of the observations are larger than <span class="math inline">\(P_{95}\)</span>, the 95% percentile</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<div id="tbl-disp-stats" class="striped quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-disp-stats-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;6.2: Important statistics measuring dispersion (variability) of a variable in a sample of size <span class="math inline">\(n\)</span>.
</figcaption>
<div aria-describedby="tbl-disp-stats-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-striped table">
<colgroup>
<col style="width: 20%">
<col style="width: 16%">
<col style="width: 20%">
<col style="width: 42%">
</colgroup>
<thead>
<tr class="header">
<th>Sample Statistic</th>
<th>Symbol</th>
<th style="text-align: center;">Computation</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Range</td>
<td><span class="math inline">\(R\)</span></td>
<td style="text-align: center;"><span class="math inline">\(Y^*[n] - Y^*[1]\)</span></td>
<td>Simply largest minus smallest value</td>
</tr>
<tr class="even">
<td>Inter-quartile Range</td>
<td>IQR</td>
<td style="text-align: center;"><span class="math inline">\(Q_3 - Q_1\)</span></td>
<td>Used in constructing box plots; covers the central 50% of the data</td>
</tr>
<tr class="odd">
<td>Standard Deviation</td>
<td><span class="math inline">\(S\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\sqrt{\frac{1}{n-1}\sum_{i=1}^n\left( Y_i - \overline{Y}\right)^2}\)</span></td>
<td>Most important dispersion measure; in the same units as the sample mean (the units of <span class="math inline">\(Y\)</span>)</td>
</tr>
<tr class="even">
<td>Variance</td>
<td><span class="math inline">\(S^2\)</span></td>
<td style="text-align: center;"><span class="math inline">\(\frac{1}{n-1}\sum_{i=1}^n \left( Y_i - \overline{Y} \right)^2\)</span></td>
<td>Important statistical measure of dispersion; in squared units of <span class="math inline">\(Y\)</span></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<section id="stats-package" class="level3">
<h3 class="anchored" data-anchor-id="stats-package"><code>stats</code> Package</h3>
<p>The following list of functions provides basic location and dispersion statistics in <code>R</code> (<code>stats</code> package). The <code>min</code> and <code>max</code> functions are provided by the <code>base</code> package.</p>
<div id="tbl-R-summary-funcs" class="striped quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-R-summary-funcs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;6.3: <code>R</code> summarization functions in <code>stats</code>.
</figcaption>
<div aria-describedby="tbl-R-summary-funcs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-striped table">
<colgroup>
<col style="width: 23%">
<col style="width: 38%">
<col style="width: 38%">
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>Description</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>mean</code></td>
<td>Sample (arithmetic) mean</td>
<td>can be trimmed (<code>trim=</code>)</td>
</tr>
<tr class="even">
<td><code>median</code></td>
<td>Sample median</td>
<td></td>
</tr>
<tr class="odd">
<td><code>sd</code></td>
<td>Standard deviation</td>
<td>uses <span class="math inline">\(n-1\)</span> as denominator</td>
</tr>
<tr class="even">
<td><code>var</code></td>
<td>Sample variance</td>
<td>uses <span class="math inline">\(n-1\)</span> as denominator. Also can calculate variance-covariance matrix of vectors</td>
</tr>
<tr class="odd">
<td><code>range</code></td>
<td>Minimum and maximum</td>
<td>returns a vector with two values</td>
</tr>
<tr class="even">
<td><code>IQR</code></td>
<td>Interquartile range</td>
<td></td>
</tr>
<tr class="odd">
<td><code>mad</code></td>
<td>Median absolute deviation</td>
<td>default metric for center is the median</td>
</tr>
<tr class="even">
<td><code>quantile</code></td>
<td>Sample quantiles</td>
<td>give list of probabilities in <code>probs=</code> argument; default is minimum, maximum, <span class="math inline">\(Q_1\)</span>, <span class="math inline">\(Q_2\)</span>, and <span class="math inline">\(Q_3\)</span></td>
</tr>
<tr class="odd">
<td><code>fivenum</code></td>
<td>Tukey’s five number summary</td>
<td>Min, lower hinge, median, upper hinge, maximum</td>
</tr>
<tr class="even">
<td><code>boxplot.stats</code></td>
<td>Statistics to construct box plot</td>
<td><code>stats</code> value contains extreme of lower whisker, lower hinge, median, upper hinge, extreme of upper whisker</td>
</tr>
<tr class="odd">
<td><code>cov</code></td>
<td>Sample covariance</td>
<td>Single statistic or covariance matrix</td>
</tr>
<tr class="even">
<td><code>cor</code></td>
<td>Sample correlation</td>
<td>Single statistic or correlation matrix</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>The <code>summary</code> function in <code>R</code> is a generic function that produces summaries of an <code>R</code> object. The return value depends on the type of its argument. When <code>summary</code> is called on a data frame, it returns basic location statistics for the numeric variables and the counts-per-level for factors. Interestingly, it does not compute any measures of dispersion.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(iris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Sepal.Length    Sepal.Width     Petal.Length    Petal.Width   
 Min.   :4.300   Min.   :2.000   Min.   :1.000   Min.   :0.100  
 1st Qu.:5.100   1st Qu.:2.800   1st Qu.:1.600   1st Qu.:0.300  
 Median :5.800   Median :3.000   Median :4.350   Median :1.300  
 Mean   :5.843   Mean   :3.057   Mean   :3.758   Mean   :1.199  
 3rd Qu.:6.400   3rd Qu.:3.300   3rd Qu.:5.100   3rd Qu.:1.800  
 Max.   :7.900   Max.   :4.400   Max.   :6.900   Max.   :2.500  
       Species  
 setosa    :50  
 versicolor:50  
 virginica :50  
                
                
                </code></pre>
</div>
</div>
<p>To compute some of the functions in <a href="#tbl-R-summary-funcs" class="quarto-xref">Table&nbsp;<span>6.3</span></a> for multiple columns in a matrix or data frame, the <code>apply</code> function is very helpful. The following function call request the mean for the numeric columns (the first four columns) of the <code>iris</code> data set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(iris[,<span class="sc">-</span><span class="dv">5</span>],<span class="dv">2</span>,mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
    5.843333     3.057333     3.758000     1.199333 </code></pre>
</div>
</div>
<p>The next statement requests the standard deviations</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(iris[,<span class="sc">-</span><span class="dv">5</span>],<span class="dv">2</span>,sd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
   0.8280661    0.4358663    1.7652982    0.7622377 </code></pre>
</div>
</div>
<p>The second argument specifies the margin over which the function will be applied: <code>1</code> implies calculations for rows, <code>2</code> implies calculations for columns. The following statements compute column and row sums for the 50 <em>I. setosa</em> observations in the <code>iris</code> data set</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>col.sums <span class="ot">&lt;-</span> <span class="fu">apply</span>(iris[iris<span class="sc">$</span>Species<span class="sc">==</span><span class="st">"setosa"</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="dv">2</span>, sum)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>col.sums</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sepal.Length  Sepal.Width Petal.Length  Petal.Width 
       250.3        171.4         73.1         12.3 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>row.sums <span class="ot">&lt;-</span> <span class="fu">apply</span>(iris[iris<span class="sc">$</span>Species<span class="sc">==</span><span class="st">"setosa"</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="dv">1</span>, sum)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>row.sums</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   1    2    3    4    5    6    7    8    9   10   11   12   13   14   15   16 
10.2  9.5  9.4  9.4 10.2 11.4  9.7 10.1  8.9  9.6 10.8 10.0  9.3  8.5 11.2 12.0 
  17   18   19   20   21   22   23   24   25   26   27   28   29   30   31   32 
11.0 10.3 11.5 10.7 10.7 10.7  9.4 10.6 10.3  9.8 10.4 10.4 10.2  9.7  9.7 10.7 
  33   34   35   36   37   38   39   40   41   42   43   44   45   46   47   48 
10.9 11.3  9.7  9.6 10.5 10.0  8.9 10.2 10.1  8.4  9.1 10.7 11.2  9.5 10.7  9.4 
  49   50 
10.7  9.9 </code></pre>
</div>
</div>
</section>
<section id="dplyr-package" class="level3">
<h3 class="anchored" data-anchor-id="dplyr-package"><code>dplyr</code> Package</h3>
<p>The <a href="https://dplyr.tidyverse.org/"><code>dplyr</code></a> package is part of the <a href="https://www.tidyverse.org/"><code>tidyverse</code></a>, an “opinionated” collection of <code>R</code> packages for data science. Packages in the <code>tidyverse</code> include <code>dplyr</code>, <code>ggplot2</code>, <code>tibble</code>, <code>tidyr</code>, <code>purr</code>, <code>stringr</code>, and <code>readr</code>. <code>dplyr</code>, <code>tidyr</code> and <code>ggplot2</code> are arguably the most important packages in the collection (that is my “opinionated” view).</p>
<p>The <code>tidyverse</code> packages share a common philosophy; that makes it easy to use code across multiple packages and to combine them. An example of this common philosophy is <strong>piping</strong>.</p>
<p>Suppose we use <code>dplyr</code> to compute the mean and standard deviation for the petal width of <em>I. virginica</em> observations in the <code>iris</code> data set. You can put this together in a single function call to the <code>dplyr::summarize</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summarize</span>(<span class="fu">filter</span>(iris,Species<span class="sc">==</span><span class="st">"virginica"</span>), </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">count=</span><span class="fu">n</span>(),</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>          <span class="at">mean=</span><span class="fu">mean</span>(Petal.Width), </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>          <span class="at">stdDev=</span><span class="fu">sd</span>(Petal.Width))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  count  mean    stdDev
1    50 2.026 0.2746501</code></pre>
</div>
</div>
<p>A more elegant way of processing the data is with a series of steps, where the result of one step is passed automatically to the next step. In <code>tidyverse</code> syntax, such a step is called a <strong>pipe</strong> and indicated with <code>%&gt;%</code>. Rewriting the previous <code>summarize</code> statement using pipes leads to</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Species<span class="sc">==</span><span class="st">"virginica"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">count =</span><span class="fu">n</span>(),</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean  =</span><span class="fu">mean</span>(Petal.Width),</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">stdDev=</span><span class="fu">sd</span>(Petal.Width)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  count  mean    stdDev
1    50 2.026 0.2746501</code></pre>
</div>
</div>
<p>The pipeline starts with the data frame <code>iris</code>. Since a pipe operation passes its input as the first argument to the next operation, the <code>filter</code> statement is really <code>filter(iris,Species=="virginica)</code>.</p>
<p>If you want to save the result of this piping operation, simply assign it to an object:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>virg_summ <span class="ot">&lt;-</span> iris <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Species<span class="sc">==</span><span class="st">"virginica"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">summarize</span>(<span class="at">count =</span><span class="fu">n</span>(),</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">mean  =</span><span class="fu">mean</span>(Petal.Width),</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">stdDev=</span><span class="fu">sd</span>(Petal.Width)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Or, you can keep going, piping the result into other <code>tidyverse</code> functions, for example</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Species<span class="sc">==</span><span class="st">"virginica"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">count =</span><span class="fu">n</span>(),</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">mean  =</span><span class="fu">mean</span>(Petal.Width),</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">stdDev=</span><span class="fu">sd</span>(Petal.Width)) <span class="sc">%&gt;%</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1
Columns: 3
$ count  &lt;int&gt; 50
$ mean   &lt;dbl&gt; 2.026
$ stdDev &lt;dbl&gt; 0.2746501</code></pre>
</div>
</div>
<p><a href="#tbl-dlyr-summary-funcs" class="quarto-xref">Table&nbsp;<span>6.4</span></a> lists summarization functions in <code>dplyr</code>.</p>
<div id="tbl-dlyr-summary-funcs" class="striped quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-dlyr-summary-funcs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;6.4: Summarization functions in <code>dplyr</code>.
</figcaption>
<div aria-describedby="tbl-dlyr-summary-funcs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-striped table">
<thead>
<tr class="header">
<th>Function</th>
<th>Description</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>mean</code></td>
<td>Sample (arithmetic) mean</td>
<td></td>
</tr>
<tr class="even">
<td><code>median</code></td>
<td>Sample median</td>
<td></td>
</tr>
<tr class="odd">
<td><code>sd</code></td>
<td>Standard deviation</td>
<td>uses <span class="math inline">\(n-1\)</span> as denominator</td>
</tr>
<tr class="even">
<td><code>var</code></td>
<td>Sample variance</td>
<td>uses <span class="math inline">\(n-1\)</span> as denominator</td>
</tr>
<tr class="odd">
<td><code>min</code></td>
<td>Minimim</td>
<td></td>
</tr>
<tr class="even">
<td><code>max</code></td>
<td>Maximum</td>
<td></td>
</tr>
<tr class="odd">
<td><code>IQR</code></td>
<td>Interquartile range</td>
<td></td>
</tr>
<tr class="even">
<td><code>first</code></td>
<td>First value of a vector</td>
<td></td>
</tr>
<tr class="odd">
<td><code>last</code></td>
<td>Last value of a vector</td>
<td></td>
</tr>
<tr class="even">
<td><code>nth</code></td>
<td><span class="math inline">\(n\)</span><sup>th</sup> value of a vector</td>
<td></td>
</tr>
<tr class="odd">
<td><code>n</code></td>
<td>Number of values in a vector</td>
<td></td>
</tr>
<tr class="even">
<td><code>n_distinct</code></td>
<td>Number of distinct (unique) values in a vector</td>
<td></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<hr>
<p>In the previous examples we filtered and summarized on a single variable. If you want to calculate statistics for multiple variables you can either repeat the statements or indicate that the operation should apply across multiple columns. In the early release of <code>dplyr</code> the <code>summarize_each</code> function applied summary calculations for more than one column. This function has been deprecated in favor of <code>across</code>, which gathers multiple columns and can be applied to other <code>dplyr</code> statements as well (<code>filter</code>, <code>group_by</code>, etc.).</p>
<p>The following statement computes the mean for all numeric columns of the <code>iris</code> data set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), mean))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Sepal.Length Sepal.Width Petal.Length Petal.Width
1     5.843333    3.057333        3.758    1.199333</code></pre>
</div>
</div>
<p>The next form of <code>summarize(across())</code> computes sample mean and median for the variables whose name begins with <code>Sepal</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"Sepal"</span>), </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">list</span>(<span class="at">mn=</span>mean, <span class="at">md=</span>median)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Sepal.Length_mn Sepal.Length_md Sepal.Width_mn Sepal.Width_md
1        5.843333             5.8       3.057333              3</code></pre>
</div>
</div>
<hr>
<p>The order in which the data manipulations occur matter greatly for the result. In the following statement, the observations are filtered for which the <code>Sepal.Length</code> exceeds the average <code>Sepal.Length</code> by 10%.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Sepal.Length <span class="sc">&gt;</span> <span class="fl">1.1</span><span class="sc">*</span><span class="fu">mean</span>(Sepal.Length))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Sepal.Length Sepal.Width Petal.Length Petal.Width    Species
1           7.0         3.2          4.7         1.4 versicolor
2           6.9         3.1          4.9         1.5 versicolor
3           6.5         2.8          4.6         1.5 versicolor
4           6.6         2.9          4.6         1.3 versicolor
5           6.7         3.1          4.4         1.4 versicolor
6           6.6         3.0          4.4         1.4 versicolor
7           6.8         2.8          4.8         1.4 versicolor
8           6.7         3.0          5.0         1.7 versicolor
9           6.7         3.1          4.7         1.5 versicolor
10          7.1         3.0          5.9         2.1  virginica
11          6.5         3.0          5.8         2.2  virginica
12          7.6         3.0          6.6         2.1  virginica
13          7.3         2.9          6.3         1.8  virginica
14          6.7         2.5          5.8         1.8  virginica
15          7.2         3.6          6.1         2.5  virginica
16          6.5         3.2          5.1         2.0  virginica
17          6.8         3.0          5.5         2.1  virginica
18          6.5         3.0          5.5         1.8  virginica
19          7.7         3.8          6.7         2.2  virginica
20          7.7         2.6          6.9         2.3  virginica
21          6.9         3.2          5.7         2.3  virginica
22          7.7         2.8          6.7         2.0  virginica
23          6.7         3.3          5.7         2.1  virginica
24          7.2         3.2          6.0         1.8  virginica
25          7.2         3.0          5.8         1.6  virginica
26          7.4         2.8          6.1         1.9  virginica
27          7.9         3.8          6.4         2.0  virginica
28          7.7         3.0          6.1         2.3  virginica
29          6.9         3.1          5.4         2.1  virginica
30          6.7         3.1          5.6         2.4  virginica
31          6.9         3.1          5.1         2.3  virginica
32          6.8         3.2          5.9         2.3  virginica
33          6.7         3.3          5.7         2.5  virginica
34          6.7         3.0          5.2         2.3  virginica
35          6.5         3.0          5.2         2.0  virginica</code></pre>
</div>
</div>
<p>The average is computed across all 150 observations in the data set (50 observations for each species). By adding a <code>group_by</code> statement prior to the filter, the sepal lengths are being compared to the species-specific means. The presence of the <code>group_by</code> statement conditions the subsequent <code>filter</code> to be applied separately for each of the three species.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Species) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Sepal.Length <span class="sc">&gt;</span> <span class="fl">1.1</span><span class="sc">*</span><span class="fu">mean</span>(Sepal.Length))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 19 × 5
# Groups:   Species [3]
   Sepal.Length Sepal.Width Petal.Length Petal.Width Species   
          &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;     
 1          5.8         4            1.2         0.2 setosa    
 2          5.7         4.4          1.5         0.4 setosa    
 3          5.7         3.8          1.7         0.3 setosa    
 4          7           3.2          4.7         1.4 versicolor
 5          6.9         3.1          4.9         1.5 versicolor
 6          6.6         2.9          4.6         1.3 versicolor
 7          6.7         3.1          4.4         1.4 versicolor
 8          6.6         3            4.4         1.4 versicolor
 9          6.8         2.8          4.8         1.4 versicolor
10          6.7         3            5           1.7 versicolor
11          6.7         3.1          4.7         1.5 versicolor
12          7.6         3            6.6         2.1 virginica 
13          7.3         2.9          6.3         1.8 virginica 
14          7.7         3.8          6.7         2.2 virginica 
15          7.7         2.6          6.9         2.3 virginica 
16          7.7         2.8          6.7         2   virginica 
17          7.4         2.8          6.1         1.9 virginica 
18          7.9         3.8          6.4         2   virginica 
19          7.7         3            6.1         2.3 virginica </code></pre>
</div>
</div>
<p>None of the <em>I. setosa</em> observations exceeded the overall sepal length by 10%. But three of the <em>I. setosa</em> observations exceeded the petal length of that species by 10%.</p>
</section>
</section>
<section id="group-by-summarization" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="group-by-summarization"><span class="header-section-number">6.3</span> Group-by Summarization</h2>
<section id="using-statsaggregate" class="level3">
<h3 class="anchored" data-anchor-id="using-statsaggregate">Using <code>stats::aggregate</code></h3>
<p>The preceding <code>dplyr</code> pipeline is an example of group-by processing: computing summaries separately for the levels of a qualitative variable (<code>Species</code>).</p>
<p>Group-by summarization is also possible with functions in the <code>stats</code> package. The <code>aggregate</code> function allows the use of the formula syntax that is common in many <code>stats</code> function. In addition to the “model”, you need to specify the aggregation function you wish to apply. For example, to compute the means for petal length by species and the standard deviations for petal length and petal width by species, use the following syntax:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(Petal.Length <span class="sc">~</span> Species, <span class="at">data=</span>iris, <span class="at">FUN=</span><span class="st">"mean"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Species Petal.Length
1     setosa        1.462
2 versicolor        4.260
3  virginica        5.552</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(<span class="fu">cbind</span>(Petal.Length,Petal.Width) <span class="sc">~</span> Species, <span class="at">data=</span>iris, <span class="at">FUN=</span><span class="st">"sd"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Species Petal.Length Petal.Width
1     setosa    0.1736640   0.1053856
2 versicolor    0.4699110   0.1977527
3  virginica    0.5518947   0.2746501</code></pre>
</div>
</div>
<p>You can also use <code>aggregate</code> with functions that have more complex return arguments, <code>quantile</code> and <code>summary</code>, for example.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(Petal.Length <span class="sc">~</span> Species, <span class="at">data=</span>iris, <span class="at">FUN=</span><span class="st">"quantile"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Species Petal.Length.0% Petal.Length.25% Petal.Length.50% Petal.Length.75%
1     setosa           1.000            1.400            1.500            1.575
2 versicolor           3.000            4.000            4.350            4.600
3  virginica           4.500            5.100            5.550            5.875
  Petal.Length.100%
1             1.900
2             5.100
3             6.900</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">aggregate</span>(Petal.Length <span class="sc">~</span> Species, <span class="at">data=</span>iris, <span class="at">FUN=</span><span class="st">"summary"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Species Petal.Length.Min. Petal.Length.1st Qu. Petal.Length.Median
1     setosa             1.000                1.400               1.500
2 versicolor             3.000                4.000               4.350
3  virginica             4.500                5.100               5.550
  Petal.Length.Mean Petal.Length.3rd Qu. Petal.Length.Max.
1             1.462                1.575             1.900
2             4.260                4.600             5.100
3             5.552                5.875             6.900</code></pre>
</div>
</div>
</section>
<section id="using-dplyrgroup_by" class="level3">
<h3 class="anchored" data-anchor-id="using-dplyrgroup_by">Using <code>dplyr::group_by</code></h3>
<p>The <code>group_by</code> statement in <code>dplyr</code> is a simple technique to apply group-specific operations; it is thus one of the first statements you see in summarization after the data frame:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(gender) <span class="sc">%&gt;%</span> </span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(mass <span class="sc">&gt;</span> <span class="fu">median</span>(mass,<span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">count=</span><span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  gender    count
  &lt;chr&gt;     &lt;int&gt;
1 feminine      3
2 masculine    19
3 &lt;NA&gt;          1</code></pre>
</div>
</div>
<p>You can combine group-by execution with summarization across multiple columns. The following pipeline computes the arithmetic mean of all numeric columns i n the <code>iris</code> data set and arranges the result by descending value of the average sepal width:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">%&gt;%</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Species) <span class="sc">%&gt;%</span> </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), mean)) <span class="sc">%&gt;%</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(Sepal.Width))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 5
  Species    Sepal.Length Sepal.Width Petal.Length Petal.Width
  &lt;fct&gt;             &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt;
1 setosa             5.01        3.43         1.46       0.246
2 virginica          6.59        2.97         5.55       2.03 
3 versicolor         5.94        2.77         4.26       1.33 </code></pre>
</div>
</div>
</section>
<section id="continuous-grouping-variable" class="level3">
<h3 class="anchored" data-anchor-id="continuous-grouping-variable">Continuous Grouping Variable</h3>
<p>Group-by computations can also be used if the grouping variable is continuous. We first create bins of the continuous variable, assign observations to the bins, and then group the summaries by the bins. The following code assigns observations to four bins based on the quartiles of <code>Sepal.Length</code> an then computes the average <code>Sepal.Width</code> for each level of <code>Sepal.Length</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="annotated-cell-20"><pre class="sourceCode r code-annotation-code code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-20-1"><a href="#annotated-cell-20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="annotated-cell-20-2"><a href="#annotated-cell-20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-20-3"><a href="#annotated-cell-20-3" aria-hidden="true" tabindex="-1"></a>iris_data <span class="ot">&lt;-</span> iris</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-20" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-20-4" class="code-annotation-target"><a href="#annotated-cell-20-4" aria-hidden="true" tabindex="-1"></a>qs <span class="ot">&lt;-</span> <span class="fu">quantile</span>(iris<span class="sc">$</span>Sepal.Length, <span class="at">probs=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="dv">1</span>))</span>
<span id="annotated-cell-20-5"><a href="#annotated-cell-20-5" aria-hidden="true" tabindex="-1"></a>qs</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-20" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-20-6" class="code-annotation-target"><a href="#annotated-cell-20-6" aria-hidden="true" tabindex="-1"></a>iris_data<span class="sc">$</span>sep.len.cut <span class="ot">&lt;-</span> <span class="fu">cut</span>(<span class="at">x=</span>iris<span class="sc">$</span>Sepal.Length, <span class="at">breaks =</span> qs)</span>
<span id="annotated-cell-20-7"><a href="#annotated-cell-20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-20-8"><a href="#annotated-cell-20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix the assignment of the minimum value to the first category</span></span>
<span id="annotated-cell-20-9"><a href="#annotated-cell-20-9" aria-hidden="true" tabindex="-1"></a>iris_data<span class="sc">$</span>sep.len.cut[<span class="fu">which.min</span>(iris<span class="sc">$</span>Sepal.Length)] <span class="ot">&lt;-</span> </span>
<span id="annotated-cell-20-10"><a href="#annotated-cell-20-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">attr</span>(iris_data<span class="sc">$</span>sep.len.cut,<span class="st">"levels"</span>)[<span class="dv">1</span>]</span>
<span id="annotated-cell-20-11"><a href="#annotated-cell-20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="annotated-cell-20-12"><a href="#annotated-cell-20-12" aria-hidden="true" tabindex="-1"></a>iris_data <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(sep.len.cut) <span class="sc">%&gt;%</span></span>
<span id="annotated-cell-20-13"><a href="#annotated-cell-20-13" aria-hidden="true" tabindex="-1"></a>         <span class="fu">summarize</span>(<span class="at">count=</span><span class="fu">n</span>(), <span class="at">mean=</span><span class="fu">mean</span>(Sepal.Width))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-20" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-20" data-code-lines="4" data-code-annotation="1">The <code>quantile</code> function computes the sample quantiles for the requested vector of probabilities. 0 and 1 are included to capture the minimum and maximum value.</span>
</dd>
<dt data-target-cell="annotated-cell-20" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-20" data-code-lines="6" data-code-annotation="2">The <code>cut</code> function applies the computed quantiles as break points to bin the values of <code>Sepal.Length</code>.</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  0%  25%  50%  75% 100% 
 4.3  5.1  5.8  6.4  7.9 
# A tibble: 4 × 3
  sep.len.cut count  mean
  &lt;fct&gt;       &lt;int&gt; &lt;dbl&gt;
1 (4.3,5.1]      41  3.18
2 (5.1,5.8]      39  3.09
3 (5.8,6.4]      35  2.87
4 (6.4,7.9]      35  3.07</code></pre>
</div>
</div>
<p>You can include the creation of the categories directly into the <code>group_by</code> statement if the cutpoints require no further processing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(<span class="at">hp_cut =</span> <span class="fu">cut</span>(hp, <span class="dv">3</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">count=</span><span class="fu">n</span>(), <span class="at">mn_mpg=</span><span class="fu">mean</span>(mpg), <span class="at">mean_disp=</span><span class="fu">mean</span>(disp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  hp_cut     count mn_mpg mean_disp
  &lt;fct&gt;      &lt;int&gt;  &lt;dbl&gt;     &lt;dbl&gt;
1 (51.7,146]    17   24.2      135.
2 (146,241]     11   15.7      339.
3 (241,335]      4   14.6      340.</code></pre>
</div>
</div>
</section>
</section>
<section id="in-database-analytics" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="in-database-analytics"><span class="header-section-number">6.4</span> In-database Analytics</h2>
<p>The data processing mechanism encountered so far can be described as follows:</p>
<ul>
<li>the data resides in a file or database external to the <code>R</code> session</li>
<li>the data are loaded from the file as a data frame into the <code>R</code> session</li>
<li>the data frame is summarized</li>
</ul>
<p>This seems obvious and you might wonder if there is any other way? If you start with a CSV file, how else could data be processed? That is correct for CSV files as the file itself, or the operating system accessing it, does not have the ability to perform statistical calculations.</p>
<p>This is different however, if the data are stored in an analytic database. For example, check out <a href="https://duckdb.org/docs/sql/functions/aggregates#statistical-aggregates">this</a> page of statistical aggregation functions available in DuckDB.</p>
<p>Suppose you want to calculate the 75<sup>th</sup> percentile of a variable or the correlation between two variables. Instead of bringing the data from DuckDB into an <code>R</code> data frame and calling <code>quantile()</code> and <code>cor()</code>, you could ask the database to compute the quantile and the correlation. This is termed <strong>in-database analytics</strong>.</p>
<p>As an example, the following code uses the <code>fitness</code> table in the <code>ads.ddb</code> database to compute correlations between <code>Oxygen</code> and <code>Age</code>, <code>Weight</code>, and <code>RunTime</code> for study subjects 40 years or older.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(duckdb)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(<span class="fu">duckdb</span>(), </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">dbdir=</span><span class="st">"ads.ddb"</span>,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">read_only=</span><span class="cn">TRUE</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>query_string <span class="ot">&lt;-</span> <span class="st">"select corr(Oxygen,Age) as cOxAge, </span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="st">                 corr(Oxygen,Weight) as cOxWgt, </span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="st">                 corr(Oxygen,RunTime) as cOxRT from fitness where age &gt;= 40;"</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(con, query_string)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    cOxAge     cOxWgt      cOxRT
1 -0.14995 -0.2721521 -0.8623353</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We could have accomplished the same result in the traditional way, pulling the <code>fitness</code> table from the database into an <code>R</code> data frame and using the <code>cor</code> function in <code>R</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(<span class="fu">duckdb</span>(), <span class="at">dbdir=</span><span class="st">"ads.ddb"</span>, <span class="at">read_only=</span><span class="cn">TRUE</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>fit_df <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con, <span class="st">"select * from fitness;"</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>set <span class="ot">&lt;-</span> fit_df<span class="sc">$</span>Age <span class="sc">&gt;=</span> <span class="dv">40</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(fit_df[set,<span class="fu">c</span>(<span class="st">"Age"</span>,<span class="st">"Weight"</span>,<span class="st">"RunTime"</span>)],fit_df<span class="sc">$</span>Oxygen[set])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              [,1]
Age     -0.1499500
Weight  -0.2721521
RunTime -0.8623353</code></pre>
</div>
</div>
<p>In the second code chunk the entire <code>fitness</code> table is loaded into the <code>R</code> session, consuming memory. For a data set with 31 observations and 7 variables that is not a big deal. For a data set with 31 million observations and 700 variables that can be a deal breaker.</p>
<p>The filter is applied to the correlation operation because we loaded all the data. Another calculation might apply a different filter, so we need to have access to all observations. In the in-database approach the filter is applied to the query and no data are moved.</p>
<p>What are the advantages and disadvantages of this approach?</p>
<section id="advantages" class="level3">
<h3 class="anchored" data-anchor-id="advantages">Advantages</h3>
<p>In-database analytics is one example of pushing analytical calculations down to the data provider, rather than extracting rows of data into an analytical engine such as <code>R</code>. Hadoop and Spark are other examples where computations are pushed into the data provider itself. Google’s BigQuery cloud data warehouse is an example where even complex machine learning algorithms can be pushed into a distributed data framework. The advantages listed below apply to all forms of push-down analytics.</p>
<ul>
<li><p>Analytic databases such as DuckDB are designed for analytical work, that is, deep scans of tables that process a limited number of columns, filter data, and compute aggregations.</p></li>
<li><p>Analytic databases are optimized for these calculations and their performance is typically excellent; they take advantage of parallel processing where possible.</p></li>
<li><p>The data is not being moved from the database into the <code>R</code> session. Only the results are being moved between the two. This is a very important attribute of in-database analytics. You will find that many organizations resist moving data out of an operational system and making data copies on other devices. It presents a major data governance and security challenge. With in-database analytics, the rows of data remains in the database, only aggregations are sent to the calling session.</p></li>
<li><p>The same functionality can be accessed from multiple compute clients, as long as the clients are able to send SQL queries to the database.</p></li>
<li><p>Very large volumes of data can be processed since the data are already held in the database and do not need to be moved to a laptop or PC that would not have sufficient memory to hold the data frame. You do not need two copies of the data before making any calculations.</p></li>
</ul>
</section>
<section id="disadvantages" class="level3">
<h3 class="anchored" data-anchor-id="disadvantages">Disadvantages</h3>
<p>There are a few downsides when you rely on the data provider to perform the statistical computations.</p>
<ul>
<li><p>Limited support for statistical functionality. In most cases you are limited to simple aggregations and summarization. More complex statistical analysis, for example, fitting models, simulations, and optimizations are beyond the scope of most data engines.</p></li>
<li><p>You have to express the analytics using the language or interface of the data provider. In most cases that is some form of SQL. You have to figure out the syntax and it can be more cumbersome than the <code>R</code> or Python functions you are used to.</p></li>
<li><p>Statistical calculations require memory and CPU/GPU resources. Database administrators (DBAs) might frown upon using resources for statistical work when the primary reason for the database is different—for example, reporting company metrics on dashboards. Even if the database could perform more advanced statistical computing such as modeling, optimizations, and simulations, DBAs do not want an operational database to be hammered by those.</p></li>
</ul>
</section>
<section id="example" class="level3">
<h3 class="anchored" data-anchor-id="example">Example</h3>
<p>Below is an example of an <code>R</code> function that performs summarization of data stored in a DuckDB database using in-database analytics. The SELECT statement computes several statistics for a single column of the database, specified in the <code>columnName</code> argument. The function supports a WHERE clause and a single GROUP BY variable. As an exercise, you can enhance the function to accept a list of GROUP BY variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>ducksummary <span class="ot">&lt;-</span> <span class="cf">function</span>(tableName, </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>                        columnName,</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">whereClause=</span><span class="cn">NULL</span>, </span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">groupBy=</span><span class="cn">NULL</span>,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>                        <span class="at">dbName=</span><span class="st">"ads.ddb"</span>) {</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(tableName) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.null</span>(columnName)) {</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="sc">!</span>(<span class="st">"duckdb"</span> <span class="sc">%in%</span> (<span class="fu">.packages</span>()))) {</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">suppressWarnings</span>(<span class="fu">library</span>(<span class="st">"duckdb"</span>))</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>            <span class="fu">message</span>(<span class="st">"duckdb library was loaded to execute duckload()."</span>)</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>        con <span class="ot">&lt;-</span> <span class="fu">dbConnect</span>(<span class="fu">duckdb</span>(), <span class="at">dbdir=</span>dbName, <span class="at">read_only=</span><span class="cn">TRUE</span>)</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(groupBy)) {</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>            query_string <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"SELECT "</span>,groupBy,<span class="st">","</span>)</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>            query_string <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"SELECT "</span>)</span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>        query_string <span class="ot">&lt;-</span> <span class="fu">paste</span>(query_string, </span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"count("</span>        , columnName,<span class="st">") as N,"</span>       ,</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"min("</span>          , columnName,<span class="st">") as Min,"</span>     ,</span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"quantile_cont("</span>, columnName, <span class="st">",0.25) as Q1,"</span>,</span>
<span id="cb46-22"><a href="#cb46-22" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"avg("</span>          , columnName,<span class="st">") as Mean,"</span>    ,</span>
<span id="cb46-23"><a href="#cb46-23" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"median("</span>       , columnName,<span class="st">") as Median,"</span>  ,</span>
<span id="cb46-24"><a href="#cb46-24" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"quantile_cont("</span>, columnName,<span class="st">",0.75) as Q3,"</span> ,</span>
<span id="cb46-25"><a href="#cb46-25" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"max("</span>          , columnName,<span class="st">") as Max,"</span>     ,</span>
<span id="cb46-26"><a href="#cb46-26" aria-hidden="true" tabindex="-1"></a>                              <span class="st">"stddev_samp("</span>  , columnName, <span class="st">") as StdDev"</span>  ,</span>
<span id="cb46-27"><a href="#cb46-27" aria-hidden="true" tabindex="-1"></a>                             <span class="st">" from "</span>, tableName)</span>
<span id="cb46-28"><a href="#cb46-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(whereClause)) {</span>
<span id="cb46-29"><a href="#cb46-29" aria-hidden="true" tabindex="-1"></a>            query_string <span class="ot">&lt;-</span> <span class="fu">paste</span>(query_string, <span class="st">" WHERE "</span>, whereClause)</span>
<span id="cb46-30"><a href="#cb46-30" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb46-31"><a href="#cb46-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(groupBy)) {</span>
<span id="cb46-32"><a href="#cb46-32" aria-hidden="true" tabindex="-1"></a>            query_string <span class="ot">&lt;-</span> <span class="fu">paste</span>(query_string, <span class="st">" GROUP BY "</span>, groupBy)</span>
<span id="cb46-33"><a href="#cb46-33" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb46-34"><a href="#cb46-34" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Adding the semicolon at the end is correct syntax, but</span></span>
<span id="cb46-35"><a href="#cb46-35" aria-hidden="true" tabindex="-1"></a>        <span class="co"># not necessary if you submit with dbGetQuery. It will</span></span>
<span id="cb46-36"><a href="#cb46-36" aria-hidden="true" tabindex="-1"></a>        <span class="co"># add a missing semicolon.</span></span>
<span id="cb46-37"><a href="#cb46-37" aria-hidden="true" tabindex="-1"></a>        query_string <span class="ot">&lt;-</span> <span class="fu">paste</span>(query_string,<span class="st">";"</span>)</span>
<span id="cb46-38"><a href="#cb46-38" aria-hidden="true" tabindex="-1"></a>        <span class="co">#print(query_string)</span></span>
<span id="cb46-39"><a href="#cb46-39" aria-hidden="true" tabindex="-1"></a>        df_ <span class="ot">&lt;-</span> <span class="fu">dbGetQuery</span>(con, query_string)</span>
<span id="cb46-40"><a href="#cb46-40" aria-hidden="true" tabindex="-1"></a>        <span class="fu">dbDisconnect</span>(con)</span>
<span id="cb46-41"><a href="#cb46-41" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span> (df_)</span>
<span id="cb46-42"><a href="#cb46-42" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb46-43"><a href="#cb46-43" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span> (<span class="cn">NULL</span>)</span>
<span id="cb46-44"><a href="#cb46-44" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb46-45"><a href="#cb46-45" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The next statement requests a summary of the <code>Oxygen</code> variable in the <code>fitness</code> table for records where <code>Age</code> is at least 40.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ducksummary</span>(<span class="st">"fitness"</span>,<span class="st">"Oxygen"</span>,<span class="st">"Age &gt;= 40"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   N    Min     Q1     Mean Median     Q3    Max  StdDev
1 29 37.388 44.811 46.85245 46.672 49.156 59.571 4.91512</code></pre>
</div>
</div>
<p>The next statement analyzes <code>Ripeness</code> of the bananas in the training data set by banana quality.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ducksummary</span>(<span class="st">"banana_train"</span>,<span class="st">"Ripeness"</span>,<span class="at">groupBy=</span><span class="st">"Quality"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Quality    N       Min         Q1       Mean    Median       Q3      Max
1    Good 2000 -4.239602  0.4206124 1.52396766 1.4982581 2.641176 7.249034
2     Bad 2000 -7.423155 -1.6555529 0.06011369 0.1125737 1.734655 5.911077
    StdDev
1 1.644378
2 2.276053</code></pre>
</div>
</div>
<p>Note that the only data frames created in this approach are the data frames to hold the analysis results. The data remains where it is at—in the database.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-Borne_2021_profiling" class="csl-entry" role="listitem">
Borne, Kirk. 2021. <span>“Data Profiling–Having That First Date with Your Data.”</span> <em>Medium</em>. <a href="https://medium.com/codex/data-profiling-having-that-first-date-with-your-data-2e05de50fca7">https://medium.com/codex/data-profiling-having-that-first-date-with-your-data-2e05de50fca7</a>.
</div>
</div>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./featproc.html" class="pagination-link" aria-label="Feature and Target Processing">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Feature and Target Processing</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./visualization.html" class="pagination-link" aria-label="Visualization">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Visualization</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Statistical Programming by Oliver Schabenberger</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>This book was built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>




<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>